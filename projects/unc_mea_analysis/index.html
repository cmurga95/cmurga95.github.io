<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title> MEA Analysis | Carlos A. Murga </title> <meta name="author" content="Carlos A. Murga"> <meta name="description" content="Multi Electrode Array Feature Analysis and Visualization"> <meta name="keywords" content="portfolio-website, data-science, data-analysis"> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link defer rel="stylesheet" href="/assets/css/scholar-icons.css?62b2ac103a88034e6882a5be5f3e2772"> <link defer rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons&amp;display=swap"> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?591dab5a4e56573bf4ef7fd332894c99" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="data:image/svg+xml,&lt;svg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20100%20100%22&gt;&lt;text%20y=%22.9em%22%20font-size=%2290%22&gt;%E2%9A%9B%EF%B8%8F&lt;/text&gt;&lt;/svg&gt;"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://cmurga95.github.io/projects/unc_mea_analysis/"> <script src="/assets/js/theme.js?a81d82887dd692e91686b43de4542f18"></script> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?5847e5ed4a4568527aa6cfab446049ca" media="none" id="highlight_theme_dark"> <script>
    initTheme();
  </script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top" role="navigation"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"> <span class="font-weight-bold">Carlos</span> A. Murga </a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">about </a> </li> <li class="nav-item "> <a class="nav-link" href="/books/">bookshelf </a> </li> <li class="nav-item "> <a class="nav-link" href="/blog/">blog </a> </li> <li class="nav-item active"> <a class="nav-link" href="/projects/">projects <span class="sr-only">(current)</span> </a> </li> <li class="nav-item "> <a class="nav-link" href="/cv/">cv </a> </li> <li class="nav-item"> <button id="search-toggle" title="Search" onclick="openSearchModal()"> <span class="nav-link">ctrl k <i class="ti ti-search"></i></span> </button> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="ti ti-sun-moon" id="light-toggle-system"></i> <i class="ti ti-moon-filled" id="light-toggle-dark"></i> <i class="ti ti-sun-filled" id="light-toggle-light"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5" role="main"> <div class="post"> <header class="post-header"> <h1 class="post-title">MEA Analysis</h1> <p class="post-description">Multi Electrode Array Feature Analysis and Visualization</p> </header> <article> <h2 id="summary">Summary</h2> <p>My work as a Research Technician at the University of North Carolina involved working with Multi Electrode Array (MEA). This is a technique to measure electrical activity from neurons. Work consisted in cleaning, merging and visualization of this in an organized and accurate manner. This is an over all workflow:</p> <pre><code class="language-mermaid">graph LR
A[Data acquisition] --&gt; B[Generate Files]
B --&gt; C[Aggregate weekly data]
C --&gt; D[Feature extraction]
D --&gt; E[Data Analysis]
</code></pre> <h2 id="objectives">Objectives</h2> <ul> <li>To develop a data analysis pipepline to facilitate data analysis and visualization</li> <li>To find optimal parameters for spike detection that minimize false positives</li> </ul> <h2 id="tools-and-skills-used">Tools and skills used</h2> <h3 id="tools">Tools</h3> <p>Python (Pandas, Dask, Numpy, Seaborn, Matplotlib), Excel</p> <h3 id="skills">Skills</h3> <p>Problem solving, feature extraction, data wrangling</p> <h2 id="challenges">Challenges</h2> <p>One of the biggest challenge was to catch up with literature and getting familiar with the whole process. It was a lot of fun regardless. Another challenge (more technical) was dealing with the vast amount of data, I overcome this by vectorizing operations, optimizing my code and leveraging other libraries such as dask.</p> <h2 id="outcome">Outcome</h2> <p>This workflow reduced times by as much as 90%. Doing this manually was very tedious and time consuming. Automation not only improved the quality of the analysis but it also validated the data and we were able to do visualizations and diagnose potential problems.</p> <hr> <h1 id="more-details-below-">More details below :))</h1> <h1 id="data-acquisition">Data Acquisition</h1> <p>The Data Acquisition step consisted in reading electrical activity of a plate. Below is an example of a plate</p> <p><img src="/assets\img\proj\Pasted%20image%2020250728150740.png"></p> <p>From which many files are generated (see below). The file we are the most interested in is the <strong>Statistics Summary</strong>. It contained a summary of the behavior of the plate for each well in terms of several metrics (Mean Firing Rate, Number of Spikes, Average Spikes per Burst, Std spikes per Bursts, etc.).</p> <pre><code class="language-mermaid">graph LR
AAA["Axis Navigator Software"] --&gt; R[.raw file] ==&gt; A[Spike Detection]

    A ==&gt; B[Burst Detector] ==&gt; C[Statistics Compiler] ==&gt; CSV&gt;" Statistics Summary .csv file"]:::outputDoc

    A --&gt; D&gt;".spk Spike File"]:::outputDoc
    A --&gt; E[Spike List] --&gt; csvsl&gt;"csv file spike list"]
    A --&gt; F[Spike Count] --&gt; csvsc&gt;"csv file spike count"]

    B --&gt; G[Electrode Burst]
    B --&gt; H[Network Burst]


    D --&gt; NMT["Spike and burst visualization - Neural Metric Tool"]

    classDef outputDoc fill:#f96,stroke:#f96
</code></pre> <h1 id="clean-and-merge-files">Clean and Merge Files</h1> <p>I wrote a Python script to do this automatically.</p> <pre><code class="language-mermaid">graph LR
  CSV@{shape: docs, label: "Statistics Summary (.csv file)"}
  CSV --&gt; A["Clean and process files (batch process)"]
  A --&gt; B["Single CSV file generation"]
  B --&gt; C["Analysis and visualization"]
</code></pre> <h1 id="my-contribution">My contribution</h1> <ul> <li>Automation of the extraction and visualization of reports</li> <li>I noticed they were not using the correct parameters to detect spikes, this lead to misleading conclusions. I proposed a different approach.</li> <li>Validation of Spikes</li> </ul> <h2 id="spike-detector">Spike Detector</h2> <p>Setting a proper detection threshold is crucial for accurate neural data analysis. Lower thresholds increase the incidence of false-positives (small noise events misidentified as spikes); higher thresholds may not detect smaller amplitude action potentials. Axion recommends an adaptive threshold of 6 x standard deviations to minimize both false-positives and missed detections. <strong>Adaptive Threshold</strong>: Threshold is set on a per electrode basis, as multiple of the noise of the continuous data. <strong>Detect Only Crossings</strong>: requires the signal to return below threshold before detecting an additional spike.</p> <h1 id="why-fixed-thresholds-fail">Why Fixed Thresholds Fail</h1> <h2 id="problem"><em>Problem</em></h2> <ul> <li>A fixed threshold (e.g., 5 µV) ignores <strong>electrode-specific noise</strong>: <ul> <li> <strong>False positives</strong>: Noisy channels misclassify noise as spikes.</li> <li> <strong>False negatives</strong>: Quiet channels miss low-amplitude spikes.</li> </ul> </li> </ul> <p><strong><em>The images below are created from synthetic data for demonstration purposes</em></strong></p> <h3 id="2uv-noise">2uV noise</h3> <p><img src="/assets\img\proj\Pasted%20image%2020250507225657.png" alt="Pasted image 20250507225657"></p> <h3 id="4-uv-noise">4 uV noise</h3> <p><img src="/assets\img\proj\Pasted%20image%2020250507225703.png" alt="Pasted image 20250507225703"></p> <h3 id="8-uv-noise">8 uV noise</h3> <p><img src="/assets\img\proj\Pasted%20image%2020250507225709.png" alt="Pasted image 20250507225709"></p> <h2 id="spike-validation">Spike Validation</h2> <h2 id="extraction-of-spike-windows-to-validate-visually">Extraction of Spike Windows to validate visually</h2> <p><img src="/assets\img\proj\Pasted%20image%2020250728151200.png" alt="Pasted image 20250728151200"></p> <p>A strategy to validate the spikes is to first take a spike waveform that we visually validate and reconstruct a wavelet based on the frequencies of said spike. Or take a spike that already looks like the spike wavelet.</p> <p>But first, denoising the signal will improve the results. For this, we use the Teager Energy Operator and reconstruct each spike, after this use the wavelet</p> <p>It would be wise (for computing reasons) to only use N number of samples, we could take Week Number 3 to run the validation protocol and exclude noisy electrodes or with poor validation scores.</p> <h2 id="sample-size-calculation">Sample size calculation</h2> <p>The N number of samples would be calculated as followed:</p> <h3 id="population-size">Population size</h3> <p>We know the total number of spikes per electrode, this would be our population size per electrode.</p> <h3 id="margin-of-error-confidence-interval">Margin of Error (Confidence Interval)</h3> <p>This percentage indicates how much our sample results may deviate from the true population value</p> <h3 id="confidence-level">Confidence Level</h3> <p>This would reflect how confident we want to be that the true population parameter lies within the margin of error that we set. Common levels are:</p> <table> <thead> <tr> <th>Level</th> <th>Z-Score</th> </tr> </thead> <tbody> <tr> <td>90%</td> <td>1.645</td> </tr> <tr> <td>95%</td> <td>1.96</td> </tr> <tr> <td>99%</td> <td>2.576</td> </tr> </tbody> </table> <h3 id="sample-size">Sample size</h3> <p>\(n=\frac{z^2 \cdot p \cdot (1 - p)}{e^2}\) p = population proportion</p> <p>e = margin of error</p> <p>z = z score associated with confidence level</p> <h5 id="for-finite-populations-like-ours">For finite populations (like ours)</h5> <p>If total number of spikes (N) is known and relatively small (e.g., &lt;100,000), adjust the sample size:</p> <p>\(n=\frac {n_{0}}{1+\frac{(n_{0}−1)}{N}}\) ​This prevents oversampling when N is small.</p> <p><strong>Important note, spikes selected must be random</strong></p> <h3 id="teager-energy-operator">Teager Energy Operator</h3> <p>It calculates the energy of a signal For this we should find signals where spikes are NOT present</p> <p>For discrete signals:</p> <p>\(x(n)=\frac{x(n)^2−x(n−1)x(n+1))}{T^2}\) Assumption of T = 1</p> <p>But we can also use \(1/fs\)</p> <h5 id="implementation-to-denoise-signal">Implementation to denoise signal</h5> <ol> <li>Find a time where a signal is not present (e.g. It is pure noise) for each electrode (take 3 random spikes and use 1 ms before and 1 ms after, we can validate visually).</li> <li>We assume that this noise is stationary (doesn’t change overtime) and use this TEO (calculated on a per electrode basis) for each own electrode (if we want to validate each weeks readings we need to re-calculate for each reading, because noise can vary)</li> <li>Based on this we clean each previously selected spike and reconstruct a clean spike.</li> <li>Move to SWT</li> </ol> <h3 id="frequency-spectrum-analysis">Frequency Spectrum Analysis</h3> <p>By deconstructing the signal in its frequency spectrum, we can determine if a signal is noise or a real expected signal from a neuron. <img src="/assets\img\proj\Pasted%20image%2020250728151334.png" alt="Pasted image 20250728151334"></p> <p>FFT has low temporal resolution, another option is to run the analysis using Stationary Wavelet Transform, which extends the Fourier transform to have better temporal resolution.</p> <p><img src="/assets\img\proj\Pasted%20image%2020250513124836.png" alt="Pasted image 20250513124836"></p> <p>SWT is decomposed into Low frequency Component (A) and the high frequency component (D). If we take the signal power ratio (D/A), we want to have a <em>high</em> signal to noise ratio. Based on this, we can then build a threshold and determine real signals from noise.</p> </article> <h2>References</h2> <div class="publications"> </div> <div id="giscus_thread"> <script defer src="/assets/js/giscus-setup.js"></script> <noscript> Please enable JavaScript to view the <a href="http://giscus.app/?ref_noscript" rel="external nofollow noopener" target="_blank">comments powered by giscus.</a> </noscript> </div> </div> </div> <footer class="fixed-bottom" role="contentinfo"> <div class="container mt-0"> © Copyright 2025 Carlos A. Murga. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" rel="external nofollow noopener" target="_blank">al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank" rel="external nofollow noopener">GitHub Pages</a>. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@5.0.0/imagesloaded.pkgd.min.js" integrity="sha256-htrLFfZJ6v5udOG+3kNLINIKh2gvoKqwEhHYfTTMICc=" crossorigin="anonymous"></script> <script defer src="/assets/js/masonry.js?a0db7e5d5c70cc3252b3138b0c91dcaf" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/mermaid@10.7.0/dist/mermaid.min.js" integrity="sha256-TtLOdUA8mstPoO6sGvHIGx2ceXrrX4KgIItO06XOn8A=" crossorigin="anonymous"></script> <script defer src="/assets/js/mermaid-setup.js?38ca0a0126f7328d2d9a46bad640931f" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.1.0/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?85ddb88934d28b74e78031fd54cf8308"></script> <script src="/assets/js/no_defer.js?2781658a0a2b13ed609542042a859126"></script> <script defer src="/assets/js/common.js?c15de51d4bb57887caa2c21988d97279"></script> <script defer src="/assets/js/copy_code.js?c8a01c11a92744d44b093fc3bda915df" type="text/javascript"></script> <script defer src="/assets/js/jupyter_new_tab.js?d9f17b6adc2311cbabd747f4538bb15f"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script> <script src="/assets/js/mathjax-setup.js?a5bb4e6a542c546dd929b24b8b236dfd"></script> <script defer src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6" crossorigin="anonymous"></script> <script defer src="/assets/js/progress-bar.js?2f30e0e6801ea8f5036fa66e1ab0a71a" type="text/javascript"></script> <script src="/assets/js/vanilla-back-to-top.min.js?f40d453793ff4f64e238e420181a1d17"></script> <script>
    addBackToTop();
  </script> <script type="module" src="/assets/js/search/ninja-keys.min.js?a3446f084dcaecc5f75aa1757d087dcf"></script> <ninja-keys hidebreadcrumbs noautoloadmdicons placeholder="Type to start searching"></ninja-keys> <script src="/assets/js/search-setup.js?6c304f7b1992d4b60f7a07956e52f04a"></script> <script src="/assets/js/search-data.js"></script> <script src="/assets/js/shortcut-key.js?6f508d74becd347268a7f822bca7309d"></script> </body> </html>